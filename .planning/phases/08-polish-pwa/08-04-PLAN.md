---
phase: 08-polish-pwa
plan: 04
type: execute
domain: frontend-design
---

<objective>
Implement custom virtual keyboard for mobile input using react-simple-keyboard.

Purpose: Provide excellent mobile solving experience without system keyboard issues.
Output: CrosswordKeyboard component with letters, backspace, and quick actions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-pwa/08-CONTEXT.md
@.planning/phases/08-polish-pwa/08-RESEARCH.md
@.planning/phases/08-polish-pwa/08-03-PLAN.md
@src/hooks/usePuzzleState.ts
@src/App.tsx

**Tech stack available:** React 19, react-simple-keyboard (to install)
**Established patterns:** Event handlers in App.tsx, usePuzzleState for input

**From CONTEXT.md (keyboard mockup):**
```
‚îÇ Q W E R T Y U I O P    ‚îÇ ‚úì Check  ‚îÇ    ‚îÇ
‚îÇ  A S D F G H J K L     ‚îÇ üëÅ Reveal ‚îÇ    ‚îÇ
‚îÇ   Z X C V B N M ‚å´     ‚îÇ ‚ÜîÔ∏è Toggle ‚îÇ    ‚îÇ
```

**From RESEARCH.md:**
- Use react-simple-keyboard for virtual keyboard
- iOS focus issues avoided by not using real input
- Intercept taps directly, no programmatic focus needed

**Key requirements:**
- Letters A-Z only (crossword-focused)
- Backspace key
- Optional quick action buttons (check, reveal, toggle direction)
- Large enough keys for accurate tapping
- Themed with CSS variables
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-simple-keyboard</name>
  <files>package.json</files>
  <action>
Run: npm install react-simple-keyboard

Verify package is added to dependencies.
  </action>
  <verify>npm ls react-simple-keyboard shows installed version</verify>
  <done>react-simple-keyboard installed</done>
</task>

<task type="auto">
  <name>Task 2: Create CrosswordKeyboard component</name>
  <files>src/components/Keyboard/CrosswordKeyboard.tsx, src/components/Keyboard/CrosswordKeyboard.css</files>
  <action>
Create keyboard component:

**CrosswordKeyboard.tsx:**
```typescript
import Keyboard from 'react-simple-keyboard';
import 'react-simple-keyboard/build/css/index.css';
import './CrosswordKeyboard.css';

interface CrosswordKeyboardProps {
  onKeyPress: (key: string) => void;
  onBackspace: () => void;
  onCheck?: () => void;
  onReveal?: () => void;
  onToggleDirection?: () => void;
  showActions?: boolean;
}
```

Layout options:
1. Main layout: QWERTY with backspace on bottom row
2. No number row (crosswords are letters only)
3. Optional action buttons as separate row or side panel

Use react-simple-keyboard layout configuration:
```typescript
const layout = {
  default: [
    'Q W E R T Y U I O P',
    'A S D F G H J K L',
    'Z X C V B N M {bksp}',
  ],
};

const display = {
  '{bksp}': '‚å´',
};
```

Handle key presses:
- Letter keys: call onKeyPress(button) with uppercase letter
- {bksp}: call onBackspace()

**CrosswordKeyboard.css:**
Override react-simple-keyboard default styles:
- Use theme CSS variables for colors
- Keys: var(--color-keyboard-key) background
- Active state: var(--color-keyboard-key-active)
- Background: var(--color-keyboard-bg)
- Font size: larger for touch targets (recommend 18-20px)
- Key height: at least 44px for accessibility
- Border radius: subtle rounded corners
- No shadows or 3D effects (clean, flat design)

Consider adding action buttons as a row above keyboard:
```css
.keyboard-actions {
  display: flex;
  gap: 8px;
  padding: 8px;
  justify-content: flex-end;
}
```
  </action>
  <verify>Component compiles, keyboard renders</verify>
  <done>CrosswordKeyboard component with themed styling</done>
</task>

<task type="auto">
  <name>Task 3: Integrate keyboard in SolveLayout</name>
  <files>src/App.tsx, src/components/Layout/SolveLayout.tsx</files>
  <action>
Integrate keyboard into solving view:

**App.tsx changes:**
1. Import CrosswordKeyboard
2. Create keyboard handlers that call usePuzzleState methods:
   - handleKeyboardPress(key): simulate typing that letter
   - handleKeyboardBackspace(): simulate backspace
3. Detect if mobile (viewport width < 768px or touch device)
   - Can use window.matchMedia('(pointer: coarse)').matches for touch detection
4. Pass CrosswordKeyboard to SolveLayout's keyboard slot on mobile
5. On desktop, keyboard slot is null (use physical keyboard)

**Keyboard event handling:**
The keyboard should trigger the same behavior as physical keyboard:
- Letter: fill cell, advance cursor
- Backspace: clear cell or move back

Option 1 (simpler): Dispatch synthetic KeyboardEvent
Option 2 (cleaner): Call usePuzzleState methods directly

Recommend Option 2: Add explicit methods to usePuzzleState:
- `typeLetter(letter: string)`: fill current cell, advance
- `handleBackspace()`: existing behavior

Wire keyboard to these methods.
  </action>
  <verify>npm run dev with mobile viewport - keyboard appears and works</verify>
  <done>Keyboard integrated and functional on mobile</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Custom virtual keyboard for mobile crossword input</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open browser DevTools, enable device emulation (iPhone or similar)
    3. Open a puzzle from library
    4. Verify keyboard appears at bottom
    5. Tap cells in grid - selection works
    6. Tap keyboard letters - letters appear in cells
    7. Tap backspace - clears cell or moves back
    8. Verify keyboard styling matches app theme
    9. Test on actual mobile device if possible
    10. On desktop viewport - keyboard should NOT appear (use physical keyboard)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Keyboard appears on mobile viewports
- [ ] Letter input works correctly
- [ ] Backspace works correctly
- [ ] Keyboard styling uses theme variables
- [ ] Desktop continues to use physical keyboard
</verification>

<success_criteria>

- All tasks completed
- react-simple-keyboard integrated
- Mobile keyboard functional
- Themed to match app design
- Desktop unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-pwa/08-04-SUMMARY.md`
</output>
