---
phase: 02-puzzle-core
plan: 02
type: execute
---

<objective>
Implement keyboard navigation and letter input for crossword solving.

Purpose: Enable the core interaction loop where users can navigate the grid and enter letters with responsive, crossword-standard behavior.
Output: Working keyboard input with auto-advance, direction toggle on same-cell click, and arrow key navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-puzzle-core/02-CONTEXT.md

# Prior plan in this phase:
@.planning/phases/02-puzzle-core/02-01-SUMMARY.md (read after Plan 01 completes)

# Key files (will exist after Plan 01):
@src/types/puzzle.ts
@src/components/CrosswordGrid.tsx
@src/lib/samplePuzzle.ts

**Tech stack available:** Vite, React 19, TypeScript 5.9
**Established patterns:** Dark theme, component organization
**From 02-CONTEXT.md:**
- Auto-advance after typing
- Same-cell tap/click toggles Across/Down direction
- Arrow keys for movement
- Must feel responsive (no perceptible lag)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create puzzle state hook with input handling</name>
  <files>src/hooks/usePuzzleState.ts</files>
  <action>
Create a custom React hook that manages puzzle solving state:

```typescript
usePuzzleState(puzzle: Puzzle) => {
  userEntries: Map<string, string>,
  selectedCell: { row: number, col: number } | null,
  direction: 'across' | 'down',
  handleCellClick: (row: number, col: number) => void,
  handleKeyDown: (event: KeyboardEvent) => void,
  currentWord: { cells: { row: number, col: number }[] } | null
}
```

Behavior:
- `handleCellClick`: Select cell. If clicking same cell, toggle direction (across<->down). Skip black cells.
- `handleKeyDown`:
  - Letter keys (A-Z): Enter letter in selected cell, auto-advance to next cell in current direction (skip black cells, stop at edge)
  - Backspace: Clear current cell, move back to previous cell in direction
  - Arrow keys: Move in that direction (skip black cells)
  - Tab: Move to next word (across first, then down) - SKIP for now, implement if time
- Auto-advance: After entering letter, move to next cell in current direction. If at end of word, stay in place.

Use useCallback for handlers to prevent unnecessary re-renders. Store entries in Map<string, string> keyed by "row,col".
  </action>
  <verify>Hook compiles without errors, can be imported</verify>
  <done>Hook exports all required values, handles letter input and arrow navigation</done>
</task>

<task type="auto">
  <name>Task 2: Wire up keyboard events to App</name>
  <files>src/App.tsx, src/App.css</files>
  <action>
Update App to use the puzzle state hook and enable keyboard input:

1. Import usePuzzleState and samplePuzzle
2. Initialize state with sample puzzle
3. Add keyboard event listener:
   - Use useEffect to add/remove 'keydown' listener on document
   - Pass events to handleKeyDown from hook
4. Pass all state and handlers to CrosswordGrid
5. Update layout:
   - Replace "Coming soon" placeholder with CrosswordGrid
   - Keep title "Crossing Words" above grid
   - Grid should be centered, reasonable max-width (e.g., 400px)

Ensure the component focuses properly so keyboard events work immediately without clicking.
  </action>
  <verify>npm run dev, press arrow keys to move selection, type letters to enter them</verify>
  <done>Can navigate with arrows, type letters that appear in cells, auto-advance works</done>
</task>

<task type="auto">
  <name>Task 3: Update grid to show user entries and selection</name>
  <files>src/components/CrosswordGrid.tsx, src/components/CrosswordGrid.css</files>
  <action>
Update CrosswordGrid to display user entries and current selection:

Visual updates:
- Show user-entered letters in cells (from userEntries Map, key is "row,col")
- Selected cell: bright border (e.g., #4a9eff) and slightly lighter background
- Letters: centered, appropriately sized (1.5-2rem depending on grid size)
- Ensure cell clicks trigger onCellClick handler

Add prop for direction and use it to influence visual feedback (optional - can show direction indicator or adjust highlighting).

CSS considerations:
- Use CSS custom properties for colors to keep consistent
- Cells should have pointer cursor on hover (non-black cells)
- Smooth transitions for selection state changes (100-150ms)
  </action>
  <verify>Letters appear when typed, selection visible, clicking cells changes selection</verify>
  <done>User entries display correctly, selection state clear, smooth visual feedback</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Arrow keys navigate between cells (skipping black cells)
- [ ] Typing a letter enters it and auto-advances
- [ ] Backspace clears and moves back
- [ ] Clicking same cell toggles direction
- [ ] No perceptible input lag
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Core crossword input loop feels responsive
- Direction toggle works on same-cell click
</success_criteria>

<output>
After completion, create `.planning/phases/02-puzzle-core/02-02-SUMMARY.md`
</output>
