/**
 * CrosswordGrid container - provides sizing context for dynamic cell calculation.
 * Takes full available space from parent, allows ResizeObserver to measure.
 */
.crossword-grid-container {
    /* Default cell size (overridden by JS via inline style) */
    --cell-size: 30px;

    /* Fill available space from parent */
    width: 100%;
    height: 100%;
    /* Center the grid within container */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* CSS custom properties for consistent theming */
.crossword-grid {
    --grid-gap: 2px;
    --transition-duration: 120ms;

    display: grid;
    gap: var(--grid-gap);
    /* Grid centers within parent */
    justify-content: center;
    background-color: var(--color-border);
    padding: 2px;
    border-radius: 4px;
}

.crossword-cell {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Fixed size from grid variable, no aspect-ratio needed */
    width: var(--cell-size);
    height: var(--cell-size);
    border: 1px solid var(--color-border);
    user-select: none;
    transition:
        background-color var(--transition-duration) ease,
        border-color var(--transition-duration) ease;
}

.crossword-cell.cell--white {
    background-color: var(--color-cell-bg);
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
}

.crossword-cell.cell--white:hover {
    background-color: var(--color-cell-word);
}

.crossword-cell.cell--black {
    background-color: var(--color-cell-blocked);
    cursor: default;
}

.crossword-cell.cell--selected {
    border: 2px solid var(--color-accent);
    background-color: var(--color-cell-selected);
}

/* Custom selection styling when in collaborative mode (uses inline styles for color) */
.crossword-cell.cell--selected-custom {
    /* Outline and background applied via inline style with user's color */
    position: relative;
}

.crossword-cell.cell--in-word {
    background-color: var(--color-cell-word);
}

/* Custom word highlight in collaborative mode (uses inline styles for color) */
.crossword-cell.cell--in-word-custom {
    /* Background applied via inline style with user's color */
}

.clue-number {
    position: absolute;
    top: 1px;
    left: 2px;
    /* Scale font with cell size, smaller than letter */
    font-size: clamp(0.4rem, calc(var(--cell-size) * 0.25), 0.55rem);
    font-weight: 500;
    color: var(--color-text-muted);
    line-height: 1;
    /* Behind the letter */
    z-index: 1;
    pointer-events: none;
}

.cell-letter {
    /* Scale font with cell size, clamped with rem for accessibility */
    font-size: clamp(0.7rem, calc(var(--cell-size) * 0.55), 1.2rem);
    font-weight: 600;
    text-transform: uppercase;
    color: var(--color-text);
    line-height: 1;
    /* Above clue number */
    position: relative;
    z-index: 2;
}

/**
 * Letter entrance animation for CRDT initial load
 * Creates a pleasant "reveal" effect when saved progress loads
 * Only active when container has --animating-letters class
 */
@keyframes letter-reveal {
    from {
        opacity: 0;
        transform: scale(0.8);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.crossword-grid-container--animating-letters .cell-letter:not(:empty) {
    animation: letter-reveal 0.35s ease-out both;
}

/* Verified cell - subtle green dot behind letter */
.cell--verified::after {
    content: '';
    position: absolute;
    bottom: 2px;
    right: 2px;
    width: 4px;
    height: 4px;
    background-color: var(--color-verified);
    border-radius: 50%;
    opacity: 0.8;
    /* Behind letter, at same level as clue number */
    z-index: 1;
    pointer-events: none;
}

/* Error cell - red highlight for incorrect entry */
.cell--error {
    background-color: color-mix(in srgb, var(--color-error) 25%, transparent) !important;
}

.cell--error .cell-letter {
    color: var(--color-error);
}

/* Subtle shake animation on error (triggers when class added) */
@keyframes cell-shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-2px); }
    40% { transform: translateX(2px); }
    60% { transform: translateX(-2px); }
    80% { transform: translateX(2px); }
}

.cell--error {
    animation: cell-shake 0.3s ease-in-out;
}

/* Collaborator cursor - colored outline (set inline for dynamic color) */
.cell--collaborator-cursor {
    /* Outline styling applied via inline style for dynamic collaborator color */
    /* Position relative needed for z-index to work */
    position: relative;
}

/* ============================================================================
 * Overlapping Cursor Indicators
 * Shows when local user's cell overlaps with collaborator cursors
 * ============================================================================ */

/* Base overlap class - local user + collaborator(s) on same cell */
.cell--collaborator-overlap {
    position: relative;
}

/* Single collaborator overlapping - corner triangle indicator */
.cell--collaborator-overlap.cell--overlap-single::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 10px 10px 0;
    border-color: transparent var(--collab-color, #888) transparent transparent;
    z-index: 15;
    pointer-events: none;
}

/* Two collaborators overlapping - two corner triangles */
.cell--collaborator-overlap.cell--overlap-double::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 10px 10px 0;
    border-color: transparent var(--collab-color-1, #888) transparent transparent;
    z-index: 15;
    pointer-events: none;
}

.cell--collaborator-overlap.cell--overlap-double::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 10px 0 0 10px;
    border-color: transparent transparent transparent var(--collab-color-2, #888);
    z-index: 15;
    pointer-events: none;
}

/* 3+ collaborators "crowd" indicator */
.cell--collaborator-crowd {
    position: relative;
}

/* Crowd indicator - pulsing effect and distinct visual */
.cell--collaborator-crowd::before {
    content: '';
    position: absolute;
    top: -1px;
    right: -1px;
    width: 12px;
    height: 12px;
    background: linear-gradient(135deg, var(--collab-color-1, #888) 50%, var(--collab-color-2, #666) 50%);
    border-radius: 0 0 0 100%;
    z-index: 15;
    pointer-events: none;
    animation: crowd-pulse 2s ease-in-out infinite;
}

/* Count badge for crowd (shows actual count) */
.cell--collaborator-crowd::after {
    content: attr(data-collab-count);
    position: absolute;
    top: -2px;
    right: -2px;
    min-width: 14px;
    height: 14px;
    background: var(--color-surface);
    color: var(--color-text);
    font-size: 9px;
    font-weight: 700;
    line-height: 14px;
    text-align: center;
    border-radius: 7px;
    border: 1px solid var(--collab-color-1, var(--color-border));
    z-index: 16;
    pointer-events: none;
}

/* Subtle pulse animation for crowd indicator */
@keyframes crowd-pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.7;
        transform: scale(1.1);
    }
}

/* When crowd overlaps with local selection, emphasize more */
.cell--selected-custom.cell--collaborator-crowd::after {
    background: var(--color-warning-bg);
    border-color: var(--color-warning);
}

/* Overlapping word highlights (multiple collaborators' words on same cell)
 * Actual styling is done via inline styles (diagonal stripe pattern)
 * This class is for CSS hooks and documentation */
.cell--collaborator-highlight-overlap {
    /* Stripe pattern applied via inline style */
}

/* ============================================================================
 * Clue Reference Highlights
 * Shows cells referenced by the current clue (e.g., "See 17-Across")
 * Uses champagne/gold color to differentiate from current word (terracotta)
 * ============================================================================ */

/* Whole clue reference - subtle background highlight */
.cell--referenced-clue {
    background-color: var(--color-warning-bg) !important;
}

/* Letter-specific reference - more prominent with outline */
/* Works for both external references AND self-references ("letters X-Y here") */
.cell--referenced-letter {
    background-color: color-mix(in srgb, var(--color-warning) 25%, transparent) !important;
    outline: 2px solid var(--color-warning) !important;
    outline-offset: -2px;
    position: relative;
    z-index: 3;
}

/* Ensure letter reference outline shows even when cell is in current word */
/* This handles "letters X-Y here" self-references */
.crossword-cell.cell--in-word.cell--referenced-letter,
.crossword-cell.cell--selected.cell--referenced-letter {
    outline: 2px solid var(--color-warning) !important;
    outline-offset: -2px;
}

/* ============================================================================
 * Zoom Mode Styles
 * Provides smooth transitions and visual feedback for zoom mode
 * ============================================================================ */

.crossword-grid-container--zoomed {
    /* Optionally add visual feedback that zoom is active */
}

.crossword-grid--zoomed {
    /* Smooth transition when entering/exiting zoom mode */
    transition: transform 0.2s ease-in-out;
}

/* Prevent accidental browser zoom on pinch gestures */
.crossword-grid-container {
    touch-action: pan-x pan-y;
}

/* ============================================================================
 * Edge Indicators for Zoom Mode (Unified Grid Approach)
 * Edge cells are rendered in the same CSS Grid as main cells for perfect alignment.
 * Grid uses fractional track sizes for edges (0.4 of cell size).
 * ============================================================================ */

/* Base styling for all edge cells in the unified grid */
.crossword-cell--edge {
    /* Fill the fractional grid track completely */
    width: 100%;
    height: 100%;
    /* Visual styling for edge cells */
    opacity: 0.85;
    overflow: hidden;
    position: relative;
    cursor: pointer;
}

/* Top edge cells - content aligned to bottom, fades toward top */
.crossword-cell--edge-top {
    /* Align content to show bottom portion of cell */
    display: flex;
    align-items: flex-end;
    justify-content: center;
    /* Fade gradient toward the hidden content */
    mask-image: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
    -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
}

/* Position letter in top edge cells */
.crossword-cell--edge-top .cell-letter {
    /* Offset to show bottom portion of letter */
    transform: translateY(calc(var(--cell-size) * 0.3));
}

/* Bottom edge cells - content aligned to top, fades toward bottom */
.crossword-cell--edge-bottom {
    /* Align content to show top portion of cell */
    display: flex;
    align-items: flex-start;
    justify-content: center;
    /* Fade gradient toward the hidden content */
    mask-image: linear-gradient(to top, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
    -webkit-mask-image: linear-gradient(to top, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
}

/* Position letter in bottom edge cells */
.crossword-cell--edge-bottom .cell-letter {
    /* Offset to show top portion of letter */
    transform: translateY(calc(var(--cell-size) * -0.3));
}

/* Left edge cells - content aligned to right, fades toward left */
.crossword-cell--edge-left {
    /* Align content to show right portion of cell */
    display: flex;
    align-items: center;
    justify-content: flex-end;
    /* Fade gradient toward the hidden content */
    mask-image: linear-gradient(to right, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
    -webkit-mask-image: linear-gradient(to right, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
}

/* Position letter in left edge cells */
.crossword-cell--edge-left .cell-letter {
    /* Offset to show right portion of letter */
    transform: translateX(calc(var(--cell-size) * 0.3));
}

/* Right edge cells - content aligned to left, fades toward right */
.crossword-cell--edge-right {
    /* Align content to show left portion of cell */
    display: flex;
    align-items: center;
    justify-content: flex-start;
    /* Fade gradient toward the hidden content */
    mask-image: linear-gradient(to left, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
    -webkit-mask-image: linear-gradient(to left, rgba(0,0,0,0.3) 0%, rgba(0,0,0,1) 100%);
}

/* Position letter in right edge cells */
.crossword-cell--edge-right .cell-letter {
    /* Offset to show left portion of letter */
    transform: translateX(calc(var(--cell-size) * -0.3));
}

/* Corner placeholder cells - invisible cells to maintain grid alignment */
.crossword-cell--corner {
    /* Fill the grid cell but remain invisible */
    width: 100%;
    height: 100%;
    /* Completely transparent */
    background: transparent;
    border: none;
    pointer-events: none;
}

/* ============================================================================
 * Zoom Mode Corner Radius
 * Sharp corners when there's hidden content, rounded when at actual puzzle edge
 * ============================================================================ */

/* In zoom mode, default to sharp corners */
.crossword-grid--zoomed {
    border-radius: 0;
    position: relative;
}

/* Selectively round corners that are at actual puzzle edges */
.crossword-grid--zoomed.grid--rounded-tl {
    border-top-left-radius: 4px;
}

.crossword-grid--zoomed.grid--rounded-tr {
    border-top-right-radius: 4px;
}

.crossword-grid--zoomed.grid--rounded-bl {
    border-bottom-left-radius: 4px;
}

.crossword-grid--zoomed.grid--rounded-br {
    border-bottom-right-radius: 4px;
}

/* ============================================================================
 * Inner shadow on grid edges to indicate continuation
 * ============================================================================ */

/* Shadow overlays for edges with hidden content */
.crossword-grid--zoomed::before {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 20;
    /* Shadow will be set dynamically based on which edges have content */
    box-shadow: var(--edge-shadow, none);
    border-radius: inherit;
}
