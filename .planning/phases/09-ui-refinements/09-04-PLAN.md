---
phase: 09-ui-refinements
plan: 04
type: execute
---

<objective>
Improve clue bar readability and usability: make it taller with wrapping text, add direction toggle on tap, and auto-select first horizontal clue when opening a puzzle.

Purpose: Fix clue truncation issues and provide more intuitive clue navigation.
Output: Taller clue bar with text wrapping, tap-to-toggle direction, auto-selection of first clue on puzzle open.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-refinements/09-CONTEXT.md

**Relevant source files:**
@src/components/ClueBar.tsx
@src/components/ClueBar.css
@src/hooks/usePuzzleState.ts
@src/App.tsx

**Prior decisions:**
- Compact direction labels (A/D) in clue bar (08-03)
- Direction toggle only if alternate valid (02-03)
- Auto-advance stays at word end (02-02)

**Issues from CONTEXT.md:**
- Clues are currently cut off (text-overflow: ellipsis)
- No way to toggle direction from clue bar
- Opening puzzle shows "Select a clue" placeholder (should auto-select first)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make clue bar taller with text wrapping</name>
  <files>src/components/ClueBar.tsx, src/components/ClueBar.css</files>
  <action>
Update ClueBar styling to allow text wrapping:
1. Remove white-space: nowrap from .clue-bar__text
2. Remove text-overflow: ellipsis from .clue-bar__text
3. Allow text to wrap naturally with word-wrap: break-word
4. Set min-height for clue bar (e.g., 48px) but allow growth
5. Add max-height with overflow-y: auto for extremely long clues (e.g., max-height: 100px)
6. Adjust padding for comfortable reading

CSS changes:
- .clue-bar: min-height: 48px; allow height to grow
- .clue-bar__content: flex-wrap or vertical layout for text
- .clue-bar__text: white-space: normal; word-wrap: break-word;
- Consider line-height for readability (1.4 or similar)

Keep nav buttons on sides at fixed position (flex-shrink: 0).
Text content should expand vertically between them.

Test with long clues to ensure they display fully without truncation.
  </action>
  <verify>Long clues wrap and display fully, no truncation, clue bar grows to accommodate</verify>
  <done>Clue bar is taller, text wraps, long clues are readable without truncation</done>
</task>

<task type="auto">
  <name>Task 2: Add tap-to-toggle direction on clue bar</name>
  <files>src/components/ClueBar.tsx, src/components/ClueBar.css, src/App.tsx</files>
  <action>
Add direction toggle functionality to clue bar content area:
1. Add onToggleDirection prop to ClueBar component
2. Make clue content area clickable/tappable
3. On tap: call onToggleDirection callback
4. Add visual affordance that it's tappable (subtle hover state, cursor: pointer)

ClueBar props update:
- onToggleDirection?: () => void

Click handler:
- When user taps the clue text/content area (not nav buttons), toggle direction
- Only call onToggleDirection if it exists (prop is optional)

Visual feedback:
- cursor: pointer on .clue-bar__content
- Subtle hover state (slightly different background or opacity)
- Active state for tap feedback on mobile

Update App.tsx:
- Pass a handler that toggles direction when cell has clue in alternate direction
- Reuse existing logic from usePuzzleState for direction toggle

Note: The direction toggle should work the same as clicking on a cell - it toggles only if the current cell has a clue in the other direction. If not, it does nothing (or shows subtle feedback that toggle isn't available).
  </action>
  <verify>Tapping clue bar toggles direction (when valid), visual feedback on hover/tap</verify>
  <done>Clue bar tap toggles direction, cursor and hover states indicate interactivity</done>
</task>

<task type="auto">
  <name>Task 3: Auto-select first horizontal clue on puzzle open</name>
  <files>src/hooks/usePuzzleState.ts</files>
  <action>
Update usePuzzleState to auto-select the first cell when puzzle loads:
1. When ready becomes true and selectedCell is null, auto-select
2. Find the first across clue (clues.across[0])
3. Set selectedCell to the starting cell of that clue
4. Set direction to 'across'

Implementation in usePuzzleState:
- Add useEffect that runs when ready becomes true
- Check if selectedCell is null (no selection yet)
- Find first across clue: puzzle.clues.across[0]
- If exists: setSelectedCell({ row: clue.row, col: clue.col }), setDirection('across')
- Only do this once on initial load, not on subsequent state changes

Edge cases:
- If no across clues exist, try first down clue
- If no clues at all, leave unselected (shouldn't happen with valid puzzles)
- Don't auto-select when returning to a puzzle with existing state (check if userEntries has values?)
  - Actually, always auto-select on puzzle open - user can navigate from there

This eliminates the "Select a cell to see clue" placeholder state.
  </action>
  <verify>Opening a puzzle immediately selects first clue - no placeholder state visible</verify>
  <done>First across clue auto-selected on puzzle open, clue bar shows clue immediately</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Improved clue bar with wrapping, tap-to-toggle, and auto-select on open</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Import or download a puzzle with long clues
    3. Open the puzzle
    4. FIRST CHECK: Verify first clue is auto-selected (no "Select a cell" placeholder)
    5. Navigate to a long clue - verify text wraps and is fully readable (no truncation)
    6. Tap the clue bar text area - verify direction toggles (if alternate clue exists)
    7. Navigate to a cell with only across clue - tap clue bar - verify toggle does nothing/shows feedback
    8. Test on mobile (390px) - verify clue bar is readable and tappable
    9. Verify nav buttons (◀ ▶) still work for clue navigation
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Clue bar allows text wrapping (no truncation)
- [ ] Long clues are fully readable
- [ ] Tapping clue bar toggles direction when valid
- [ ] First clue auto-selected on puzzle open
- [ ] No "Select a cell" placeholder on fresh puzzle open
- [ ] Nav buttons still work
- [ ] Mobile layout works at 390px
- [ ] npm run build succeeds
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Clue bar is taller with wrapping text
- Tap-to-toggle direction works
- Puzzles auto-select first clue on open
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-refinements/09-04-SUMMARY.md`
</output>
