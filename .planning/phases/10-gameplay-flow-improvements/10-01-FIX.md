---
phase: 10-gameplay-flow-improvements
plan: 10-01-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 10-01 (Fixed Cell Sizing).

Source: 10-01-ISSUES.md
Priority: 0 critical, 2 major, 0 minor

**Root cause:** The current `--cell-size: clamp(24px, 6vmin, 36px)` is independent of puzzle dimensions. A 15x15 puzzle needs the same total grid width to fit as a 5x5, but has 3x more cells, so cells overflow the viewport.

**Solution approach:** Calculate cell size dynamically based on available container space divided by puzzle dimensions, while respecting min/max bounds. This requires moving from pure CSS to CSS + JS calculation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/10-gameplay-flow-improvements/10-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/10-gameplay-flow-improvements/10-01-PLAN.md

**Current implementation:**
@src/components/CrosswordGrid.tsx
@src/components/CrosswordGrid.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-001 & UAT-002 - Dynamic cell sizing based on container and puzzle dimensions</name>
  <files>src/components/CrosswordGrid.tsx, src/components/CrosswordGrid.css</files>
  <action>
The issue is that `--cell-size` is fixed regardless of puzzle dimensions. Fix by calculating cell size dynamically:

1. **In CrosswordGrid.tsx:**
   - Add a ref to measure the grid container's available width/height
   - Use `useEffect` + `ResizeObserver` to track container size changes
   - Calculate optimal cell size: `Math.min(availableWidth / cols, availableHeight / rows)`
   - Apply min/max bounds: `Math.max(16, Math.min(cellSize, 36))` (lower min from 24px to 16px to fit large puzzles)
   - Pass calculated size via inline style `--cell-size` CSS variable on the grid element

2. **In CrosswordGrid.css:**
   - Remove the static `--cell-size: clamp(24px, 6vmin, 36px)` from `.crossword-grid`
   - Keep `--cell-size` usage in child elements (it will come from inline style)
   - Add fallback: `--cell-size: 30px` as a default before JS calculates

3. **Container sizing:**
   - The grid needs to know its available space. The parent container should have bounded dimensions.
   - Check if SolveLayout provides a bounded container for the grid slot
   - If not, may need to add a wrapper with `max-height` and `max-width` constraints

4. **Calculation logic:**
   ```typescript
   const calculateCellSize = (containerWidth: number, containerHeight: number, cols: number, rows: number) => {
     const gap = 2; // --grid-gap value
     const padding = 4; // grid padding
     const totalGapX = (cols - 1) * gap + padding * 2;
     const totalGapY = (rows - 1) * gap + padding * 2;

     const maxCellWidth = (containerWidth - totalGapX) / cols;
     const maxCellHeight = (containerHeight - totalGapY) / rows;

     const cellSize = Math.min(maxCellWidth, maxCellHeight);

     // Clamp between 16px (readable minimum) and 36px (comfortable maximum)
     return Math.max(16, Math.min(cellSize, 36));
   };
   ```

5. **ResizeObserver pattern:**
   ```typescript
   const containerRef = useRef<HTMLDivElement>(null);
   const [cellSize, setCellSize] = useState(30); // default

   useEffect(() => {
     if (!containerRef.current) return;

     const observer = new ResizeObserver(entries => {
       const { width, height } = entries[0].contentRect;
       const newSize = calculateCellSize(width, height, puzzle.width, puzzle.height);
       setCellSize(newSize);
     });

     observer.observe(containerRef.current);
     return () => observer.disconnect();
   }, [puzzle.width, puzzle.height]);
   ```

6. **Apply via inline style:**
   ```tsx
   <div
     ref={containerRef}
     className="crossword-grid-container"
     style={{ '--cell-size': `${cellSize}px` } as React.CSSProperties}
   >
     <div className="crossword-grid" style={{...}}>
       ...
     </div>
   </div>
   ```

**Important:** The container needs bounded dimensions. If the current parent doesn't provide this, wrap the grid in a container with:
- `width: 100%`
- `height: 100%` (or a calculated height based on available viewport space)
- `overflow: hidden` to establish sizing context
  </action>
  <verify>
`npm run build` succeeds. Test with:
1. Open a 15x15 puzzle - should fit in viewport without overflow
2. Resize window narrower - cells should shrink to keep puzzle visible
3. Very small window - cells should not go below 16px (may need horizontal scroll at extreme sizes)
4. Small puzzle (5x5 if available) - cells should be comfortable size, not oversized
  </verify>
  <done>
UAT-001 fixed: Large puzzles fit within viewport
UAT-002 fixed: Cells shrink appropriately on narrow viewports
Grid dynamically calculates cell size based on container dimensions and puzzle size
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Large puzzles (15x15) fit within viewport without horizontal scroll
- [ ] Grid shrinks appropriately when browser window is narrowed
- [ ] Small puzzles don't have oversized cells
- [ ] Letters, clue numbers, and verified marks still scale correctly with cells
- [ ] Works on mobile viewport sizes
</verification>

<success_criteria>
- All UAT issues from 10-01-ISSUES.md addressed
- Tests pass (if any)
- Ready for re-verification via `/gsd:verify-work 10-01`
</success_criteria>

<output>
After completion, create `.planning/phases/10-gameplay-flow-improvements/10-01-FIX-SUMMARY.md`
</output>
