---
phase: 03-puzzle-import
plan: 02
type: execute
---

<objective>
Build file picker UI and integrate puzzle import with app state.

Purpose: Allow users to load their own puzzle files and solve them in the app.
Output: Working file picker that loads puzzles and replaces the sample puzzle.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-puzzle-import/03-CONTEXT.md
@.planning/phases/03-puzzle-import/DISCOVERY.md
@.planning/phases/03-puzzle-import/03-01-SUMMARY.md
@src/App.tsx
@src/App.css
@src/lib/puzzleImport.ts

**Tech stack available:** React, TypeScript, Vite
**Established patterns:** Dark theme (#1a1a2e), component CSS files alongside components

**From 03-CONTEXT.md:**
- Vision: "Simple and invisible" - users just open a file and it loads
- Essential: Format coverage, error handling, speed
- Out of scope: Saving/exporting, cloud import

**Constraining decisions:**
- Phase 01: Dark theme as default
- Phase 02: usePuzzleState hook takes Puzzle as argument
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FilePicker component</name>
  <files>src/components/FilePicker.tsx, src/components/FilePicker.css</files>
  <action>
Create src/components/FilePicker.tsx:

**Component props:**
- onPuzzleLoaded: (puzzle: Puzzle) => void
- onError: (error: string) => void

**UI structure:**
- A button styled to match app theme ("Open Puzzle" or "Load Puzzle")
- Hidden file input that accepts .puz, .ipuz, .jpz files
- Button click triggers the hidden input

**Behavior:**
1. User clicks button â†’ hidden input opens file dialog
2. On file select, call importPuzzle(file) from puzzleImport.ts
3. On success, call onPuzzleLoaded with parsed puzzle
4. On error, call onError with user-friendly message
5. Clear the input value after each selection (so same file can be re-selected)

**Styling (FilePicker.css):**
- Button matches app header style (dark theme)
- Subtle hover state
- Loading state while parsing (optional - parsing should be instant)

Use hidden input pattern:
```tsx
<input
  type="file"
  accept=".puz,.ipuz,.jpz"
  style={{ display: 'none' }}
  ref={inputRef}
/>
<button onClick={() => inputRef.current?.click()}>Open Puzzle</button>
```
  </action>
  <verify>
`npm run build` succeeds
Component renders without errors
  </verify>
  <done>FilePicker component exists with proper file input handling</done>
</task>

<task type="auto">
  <name>Task 2: Integrate FilePicker with App</name>
  <files>src/App.tsx, src/App.css</files>
  <action>
Modify App.tsx to:

1. Add state for current puzzle: `const [puzzle, setPuzzle] = useState<Puzzle>(samplePuzzle)`
2. Add state for error message: `const [error, setError] = useState<string | null>(null)`
3. Update usePuzzleState to use `puzzle` state instead of `samplePuzzle`
4. Add FilePicker to header area with handlers:
   - onPuzzleLoaded: setPuzzle, setError(null)
   - onError: setError
5. Display error message if present (dismissible or auto-clear)
6. Update puzzle title/author to use `puzzle.title` / `puzzle.author`

**Layout in App.css:**
- FilePicker button in header (right side or below tagline)
- Error message styled as toast/banner (temporary, non-blocking)
- Keep puzzle display area unchanged

**Reset state on new puzzle:**
When a new puzzle loads, the usePuzzleState hook will reset automatically since it's called with new puzzle parameter. Ensure userEntries clears (may need to lift state or add key prop).

**Error handling UX:**
- Show error below header for 5 seconds then auto-dismiss
- Or show until dismissed with X button
- Style: subtle red background, white text
  </action>
  <verify>
`npm run build` succeeds
`npm run dev` shows app with "Open Puzzle" button
  </verify>
  <done>FilePicker visible in app header, puzzle state managed in App</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>File picker and puzzle import integration</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:5173
    3. Verify "Open Puzzle" button visible in header
    4. Click button - file dialog should open
    5. Test with any .puz file you have (or skip if none available)
    6. If no test files: verify button appears, dialog opens, cancel works
    7. Check error handling: try loading a .txt file - should show error
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] FilePicker component renders in header
- [ ] File dialog opens on button click
- [ ] Accepts .puz, .ipuz, .jpz files only
- [ ] Error handling works for invalid files
</verification>

<success_criteria>

- FilePicker component created with proper styling
- Integrated into App with puzzle state management
- Error handling displays user-friendly messages
- Human verification confirms UX works as expected
- Phase 3: Puzzle Import complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-puzzle-import/03-02-SUMMARY.md`
</output>
