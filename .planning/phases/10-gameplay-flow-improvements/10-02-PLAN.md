---
phase: 10-gameplay-flow-improvements
plan: 02
type: execute
---

<objective>
Share collaborator cursor position (focused cell) in addition to word highlighting for better collaboration awareness.

Purpose: Currently collaborators only see which word each person is working on (background highlight). Showing the exact cell each collaborator is focused on provides better spatial awareness during collaborative solving.

Output: Collaborator cursors visible as colored borders on focused cells, distinct from word background highlights.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/CrosswordGrid.tsx
@src/components/CrosswordGrid.css
@src/collaboration/types.ts
@src/collaboration/useCollaborators.ts
@src/collaboration/colors.ts

**Tech stack available:** React, Yjs Awareness, CSS
**Established patterns:** useSyncExternalStore for awareness, inline rgba styles for dynamic colors

**Current implementation:**
- `CursorPosition` includes `{ row, col, direction }` - already has the focused cell!
- `useCollaborators` returns collaborators with cursor positions
- CrosswordGrid builds `collaboratorHighlights` Map for word cells
- Word cells get `cell--collaborator` class with inline background color at 25% opacity
- Color assignment uses `assignUniqueColor` to avoid collisions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add cursor cell indicator for collaborators</name>
  <files>src/components/CrosswordGrid.tsx, src/components/CrosswordGrid.css</files>
  <action>
Add visual indicator for each collaborator's focused cell (not just word):

1. In CrosswordGrid.tsx, create a new Map for cursor positions (not words):
   ```typescript
   const collaboratorCursors = useMemo(() => {
     const cursors = new Map<string, string>(); // key -> color
     for (const collab of collaborators) {
       if (!collab.cursor) continue;
       const key = `${collab.cursor.row},${collab.cursor.col}`;
       // First collaborator on cell wins
       if (!cursors.has(key)) {
         cursors.set(key, collab.user.color);
       }
     }
     return cursors;
   }, [collaborators]);
   ```

2. In the cell rendering, check if cell is a cursor position:
   ```typescript
   const cursorColor = collaboratorCursors.get(key);
   const hasCollaboratorCursor = cursorColor && !isSelected;
   ```

3. Add a new class `cell--collaborator-cursor` when `hasCollaboratorCursor` is true

4. Apply inline style for the cursor border color:
   ```typescript
   const cellStyle = {
     ...(hasCollaboratorHighlight ? { backgroundColor: hexToRgba(collaboratorColor, 0.25) } : {}),
     ...(hasCollaboratorCursor ? { boxShadow: `inset 0 0 0 2px ${cursorColor}` } : {}),
   };
   ```
   Using box-shadow instead of border to avoid layout shift.

5. In CrosswordGrid.css, add `.cell--collaborator-cursor` class (may be empty if all styling is inline, but good for potential hover states or animations)

The cursor indicator should be MORE prominent than word highlight - word is subtle background, cursor is visible border.
  </action>
  <verify>
`npm run build` succeeds. Open two browser tabs with same puzzle + timeline, move cursors - each tab should see the other's cursor cell highlighted with a colored border.
  </verify>
  <done>Collaborator focused cells show colored border indicator distinct from word background highlight.</done>
</task>

<task type="auto">
  <name>Task 2: Verify unique color assignment</name>
  <files>src/components/CrosswordGrid.tsx</files>
  <action>
Verify the color uniqueness implementation is working correctly:

1. Check that `assignUniqueColor` is being called in the P2P session setup (likely in webrtcProvider.ts or useCrdtPuzzle.ts)

2. The current implementation should already handle this - `assignUniqueColor` takes `usedColors` array and finds first unused color from palette

3. If needed, add a brief debug log in development to confirm colors are unique:
   ```typescript
   if (process.env.NODE_ENV === 'development') {
     console.debug('[Cursors] Collaborator colors:', collaborators.map(c => c.user.color));
   }
   ```

4. No changes needed if already working - just verify by testing with 2-3 tabs

This task is primarily verification. If colors are colliding, investigate where `assignUniqueColor` is called and ensure it receives the correct `usedColors` array from awareness state.
  </action>
  <verify>
Open 3 browser tabs with same puzzle + timeline. Each collaborator should have a distinct color (from the 12-color palette). No two active collaborators should share the same color.
  </verify>
  <done>Each collaborator has a unique color, no collisions in typical usage (up to 12 collaborators).</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Collaborator cursor position sharing with colored border indicators</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Open puzzle in browser tab A
    3. Click Share and copy the link
    4. Open same link in browser tab B (or different browser)
    5. In tab A, click on different cells - observe tab B shows:
       - A colored border on tab A's focused cell (cursor indicator)
       - A subtle background on tab A's current word (word highlight)
    6. In tab B, click on cells - observe tab A shows the same
    7. Verify the cursor border color matches the avatar color for that collaborator
    8. Open a third tab C - verify each tab shows both other collaborators with distinct colors
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Collaborator cursor cells show colored border
- [ ] Word highlight (background) is still visible and distinct from cursor
- [ ] Multiple collaborators each have unique colors
- [ ] Local user's selection takes priority (their cursor/word styling shown, not others')
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Collaborators can see each other's exact cursor position
- Visual distinction between cursor (border) and word (background) is clear
</success_criteria>

<output>
After completion, create `.planning/phases/10-gameplay-flow-improvements/10-02-SUMMARY.md`
</output>
