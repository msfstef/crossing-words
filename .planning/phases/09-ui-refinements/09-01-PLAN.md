---
phase: 09-ui-refinements
plan: 01
type: execute
---

<objective>
Replace the library header Import/Download buttons with a Floating Action Button (FAB) that expands vertically, and implement optimistic UI for puzzle downloads.

Purpose: Fix button overflow on 390px mobile screens and improve the download experience with immediate feedback.
Output: FAB component with expand animation, download picker dialog, ghost loading entries with optimistic UI pattern.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ui-refinements/09-CONTEXT.md

**Relevant source files:**
@src/components/Library/LibraryView.tsx
@src/components/Library/LibraryView.css
@src/components/Library/PuzzleCard.tsx
@src/components/Library/PuzzleCard.css
@src/components/PuzzleDownloader.tsx
@src/components/PuzzleDownloader.css
@src/components/FilePicker.tsx

**Prior decisions:**
- Library as default view (08-02)
- Hidden file input pattern for imports (03-02)
- Error auto-dismiss 5s with manual close (03-02)

**Tech stack:**
- React 18 with hooks
- CSS with CSS variables for theming
- sonner for toast notifications
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FAB component with expand animation</name>
  <files>src/components/Library/FAB.tsx, src/components/Library/FAB.css</files>
  <action>
Create a Floating Action Button component that:
- Renders as a circular button with "+" icon in bottom-right corner (position: fixed)
- On tap, expands vertically upward to show "Import" and "Download" options
- Uses CSS transitions for smooth expand/collapse animation (150-200ms)
- Import option triggers file input (reuse hidden input pattern from FilePicker)
- Download option opens a dialog/modal
- Clicking outside or selecting an option collapses the FAB
- Position: right: 1rem, bottom: 1rem (adjust for keyboard on mobile)
- Use existing CSS variables for colors (--color-accent, --color-bg-secondary)
- Z-index should be high enough to float above content but below modals

Props:
- onImportClick: () => void
- onDownloadClick: () => void
- fileInputRef: React.RefObject<HTMLInputElement>

CSS considerations:
- Circular main button: 56px diameter
- Expanded options: appear above main button with gap
- Use transform/opacity for animation (not height) for performance
- Handle safe-area-inset-bottom for iPhone notch devices
  </action>
  <verify>Component renders, expands on click, collapses on outside click</verify>
  <done>FAB component complete with smooth expand/collapse animation and proper positioning</done>
</task>

<task type="auto">
  <name>Task 2: Create download picker dialog with optimistic UI</name>
  <files>src/components/Library/DownloadDialog.tsx, src/components/Library/DownloadDialog.css, src/components/Library/LibraryView.tsx</files>
  <action>
Create a DownloadDialog component that replaces inline PuzzleDownloader:
- Modal/dialog overlay with source selector and date picker
- "Download" button triggers download
- On download start: immediately close dialog and call onDownloadStart callback
- Dialog should be centered with backdrop

Update LibraryView to:
- Replace header .library-actions (Import/Download buttons + SettingsMenu) with just SettingsMenu
- Add FAB component with handlers
- Manage download dialog open state
- Implement optimistic UI pattern:
  1. When download starts, immediately add a "ghost" entry to puzzles state with:
     - id: temporary unique id (e.g., 'loading-' + Date.now())
     - title: source name + date (e.g., "Universal Crossword - Jan 12, 2026")
     - loading: true flag
     - source and date from selection
  2. On success: replace ghost entry with real puzzle, open it
  3. On error: remove ghost entry, show error toast
- Ghost entries should NOT open the puzzle immediately - user stays in library

Note: Do NOT immediately open puzzle on download. User sees it appear in library, can tap it if they want to open.
  </action>
  <verify>Dialog opens from FAB, download creates ghost entry, success replaces with real entry, error removes ghost</verify>
  <done>Download dialog works with optimistic UI - ghost entries appear immediately during download</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>FAB with Import/Download options and optimistic download UI in library</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open app at 390px viewport width (mobile)
    3. Verify FAB button appears in bottom-right corner (no header button overflow)
    4. Tap FAB - verify it expands upward with Import and Download options
    5. Tap "Download" - verify dialog opens with source selector and date picker
    6. Select a source and date, tap Download
    7. Verify dialog closes immediately and ghost entry appears in library
    8. Wait for download - verify ghost becomes real puzzle entry
    9. Verify puzzle does NOT auto-open (stays in library)
    10. Tap "Import" from FAB - verify file picker opens
    11. Import a .puz file - verify it appears in library
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FAB renders correctly in bottom-right corner
- [ ] FAB expands/collapses smoothly
- [ ] Download dialog opens and closes properly
- [ ] Ghost entries appear immediately during download
- [ ] Ghost entries transition to real entries on success
- [ ] Error handling removes ghost and shows toast
- [ ] No header overflow on 390px viewport
- [ ] npm run build succeeds
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- FAB replaces header Import/Download buttons
- Download flow uses optimistic UI pattern
- Mobile viewport (390px) has no overflow issues
</success_criteria>

<output>
After completion, create `.planning/phases/09-ui-refinements/09-01-SUMMARY.md`
</output>
